<!DOCTYPE html>
<html xmlns:th="https://www.thymeleaf.org">

<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>購物車</title>
<link rel="stylesheet" type="text/css"
	th:href="@{/css/bootstrap.min.css}">
<link rel="stylesheet" type="text/css" th:href="@{/css/header.css}">
<link rel="stylesheet" th:href="@{/css/mallStyles.css}">
</head>

<body style="background-color: #fff;">
	<header class="headerPage"></header>

	<div style="display: flex; align-items: center; justify-content: center">
		<main class="content" style="min-height: 1000px;">

			<div class="card mb-3" th:each="product : ${cartEntrtSet}" style="width: 600px">
                <div class="row g-0">
                    <div class="col-md-4">
                        <img th:src="@{/product/DBGifReader(pID=${product.key.pID}, image=1)}" alt="Product Image" class="img-fluid rounded-start" width="300px" height="300px">
                    </div>
                    <div class="col-md-8">
                        <div class="card-body" style="width: 500px;">
                        <a th:href="@{/shopmall/getone/{pID}(pID=${product.key.pID})}" style="color: black;">
                        	<h5 class="card-title" th:utext="${product.key.pName}" style="margin-top:20px;">Product Name</h5>
                        </a>
                        <p style="display:inline;">單價:</p><p style="display:inline-block; width: 60px;" class="card-title" th:utext="${product.key.pPrice}">Product Price</p>
                        <p style="display:inline;">x</p><input type="number" name="quantity" id="quantityInput" min="1" th:value="${product.value}" style="width: 50px; margin-bottom: 20px;" />
                        <p style="display:inline; margin-right:30px;">小計:</p><p style="display:inline-block; width: 60px;" id="totalPrice" th:utext="${product.key.pPrice}*${product.value}"></p>
                        <form method="post" th:action="@{/shopcart/remove}" style="display:inline;">
							<img th:src="@{/images/garbagecan.png}" style="width: 30px; height: 30px; margin-left: 20px;" type="button" class="deleteBtn" data-product-id="${product.key.pID}">
							<input type="hidden" name="pID" th:value="${product.key.pID}" />
						</form>
                        </div>
                    </div>
                </div>
            </div>
            	
            	寄送方式
            	<select id="deliver" class="form-select form-select-sm" aria-label=".form-select-sm example" style=" margin-bottom:20px;">
					<option>黑貓宅急便</option>
                </select>
                
             	郵遞區號
                <select id="cityCode" class="form-select form-select-sm" aria-label=".form-select-sm example" style=" margin-bottom:20px;">
					<option>100台北市中正區</option>
					<option>103台北市大同區</option>
					<option>104台北市中山區</option>
					<option>106台北市大安區</option>
					<option>110台北市信義區</option>
                </select>

                詳細地址
                <div class="input-group mb-3">
                    <input id="floor" placeholder="必填" type="text" size="40%" required>
                </div>
                
                付款方式
                <select id="payment" class="form-select form-select-sm" aria-label=".form-select-sm example" style=" margin-bottom:20px;">
					<option>信用卡</option>
                </select>




		</main>
	</div>
	<!--         <hr> -->
	<!--         <button type="button" class="btn btn-primary" id="checkoutBtn" -->
	<!--           style="--bs-btn-padding-y: .25rem; --bs-btn-padding-x: .5rem; --bs-btn-font-size: .75rem; cursor: pointer;"> -->
	<!--           前往結帳 -->
	<!--         </button> -->
	<!--         <span style="margin-left : 490px ; color: #a5a5a5;"> -->

	<!--         </span> -->

	<footer class="footerPage"></footer>

	<script th:src="@{/js/bootstrap.bundle.min.js}"></script>
	<script th:src="@{/js/jquery-3.7.1.min.js}"></script>
	<script type="text/javascript">
	  $(document).ready(function () {
          $(".headerPage").load("/header.html");
          $(".footerPage").load("/footer.html");

          // 取得所有數量輸入框
          var quantityInputs = $("input[name='quantity']");

          // 遍歷每個輸入框
          quantityInputs.each(function () {
              // 添加事件監聽器，當值更改時觸發
              $(this).change(function () {
                  // 取得當前輸入框的值和商品單價
                  var quantity = parseInt($(this).val()) || 0; // 轉換為整數，如果無效，則設為0
                  var productPriceText = $(this).closest(".card-body").find(".card-title").text(); // 取得商品單價的文本內容
                  var productPrice = parseFloat(productPriceText.replace(/[^\d.-]/g, '')) || 0; // 將文本轉換為浮點數，如果無效，則設為0

                  // 計算總價
                  var totalPrice = productPrice * quantity +".00";

                  // 更新顯示總價的元素
                  $(this).closest(".card-body").find("#totalPrice").text(totalPrice || 0); // 如果總價無效，則設為0
              });
          });
          

          // 刪除按鈕的點擊事件
          $(".deleteBtn").click(function () {
        	    // 取得被點擊按鈕的data-product-id屬性值
        	    var productId = $(this).data("product-id");

        	    // 在這裡添加刪除商品的邏輯，可以通過Ajax請求向伺服器發送刪除請求等
        	    console.log("刪除商品，ID：" + productId);

        	    // 在這裡可以添加額外的邏輯，例如觸發表單提交
        	    $(this).closest("form").submit();
        	});
      });
	</script>

</body>

</html>